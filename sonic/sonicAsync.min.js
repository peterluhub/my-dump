(function(g){function C(a,b,c){var e=Object.keys(a),h=e.length,d=[],f;for(f=0;f<h;f+=1)d[f]=a[e[f]];B(d,b,function(d,a){if(d)return c(d);var b={};h=a.length;for(f=0;f<h;f+=1)void 0!==a[f]&&(b[e[f]]=a[f]);c(d,b)},!0)}function y(a,b,c){if(b[0].filter)b[0](a,z(a,b,1,c));else b[0](a,A(a,b,1,c))}function A(a,b,c,e){return function(a,d){var f=c;if(null===f)q(a,d);else{var k=b[f];a?e(a):(c=null,k?k.filter?k(d,z(d,b,f+1,e)):k(d,A(d,b,f+1,e)):e(a,d))}}}function z(a,b,c,e){return function(h,d){var f=c;if(null===
f)q(h,a);else{var k=b[f];h?e(h):(c=null,k?d?k.filter?k(a,z(a,b,f+1,e)):k(a,A(a,b,f+1,e)):(e.filtered=!0,e(h,void 0)):d?e(h,a):(e.filtered=!0,e(h,void 0)))}}}function l(){}function q(a,b){g.silent||console.error("callback called already; err=",a,"; data=",b);if(g.trace)console.trace("callback called already stack");else if(g.errout)throw Error("callback called already");}function w(){throw Error("limit not specified or too big");}g.inline=function(a,b,c){function e(a){return function(e,m){var s=a;
null===s?c!==l&&q(e,m):e?0<=d&&(d=-1,c(e,f)):(a=null,d-=1,0<=d&&b(m,h(s)))}}function h(a){return function(b,e){b?0<=d&&(d=-1,c(b,f)):(f[a]=e,0===d&&(d=-1,c(b,f)))}}c=c||l;var d=tasks.length,f=[];for(a=d;a;)a-=1,tasks[a](e(a))};g.transduce=function(){var a=arguments[0],b=l,c;3===arguments.length?(b=arguments[2],c=arguments[1]):"sync"===arguments[1]?c=arguments[1]:b=arguments[1];return function(e,h){b=h||b;if(e instanceof Array)if(c){if("sync"===c){var d=e.length,f=a.length,k=[],p,m,s,g,r;for(g=0;g<
d;g+=1){s=e[g];for(r=0;r<f;r+=1)if(p=a[r],m=p(s),!1===m)if(p.filter)break;else s=m;else!0===m?p.filter?m=s:s=m:s=m;m&&k.push(m)}return k}D(e,a,c,b)}else B(e,a,b);else if(e instanceof Object)if(c){if("sync"===c){m=Object.keys(e);f=m.length;k=a.length;p={};var l,n;for(l=0;l<f;l+=1){g=m[l];r=e[g];for(n=0;n<k;n+=1)if(s=a[n],d=s(r,g),!1===d)if(s.filter)break;else r=d;else!0===d?s.filter?d=r:r=d:r=d;d&&(p[g]=d)}return p}objXduceLimit(e,a,c,b)}else C(e,a,b);else y(e,a,b)}};var D=function(a,b,c,e){function h(c){y(a[c],
b,function(a,b){if(null===c)q(a,b);else if(a)p||(p=1,e(a,f));else if(k-=1,f[c]=b,c=null,m<d)p||(k+=1,h(m++));else if(!k&&!p){p=1;for(var g=0,l=[],t=f.length,u=0;u<t;u+=1)void 0!==f[u]&&(l[g]=f[u],g+=1);e(a,l)}})}e=e||l;var d=a.length;(!c||c>d)&&w();for(var f=[],k=0,p=0,m=0;m<c;m+=1)k+=1,h(m)};g.trackFilter=function(a){};g.fastWaterfall=function(a,b){function c(h,d){e+=1;var f=a[e];h?b(h):f?f(d,c):b(h,d)}b=b||l;var e=0;a[0](null,c)};g.waterfall=function(a,b){b=b||l;var c=function(e){return function(h,
d){var f=e;if(f){var k=a[f];h?b(h):k?(k(d,c(f+1)),e=null):b(h,d)}else q(h,d)}};a[0](null,c(1))};g.series=function(a,b){g.parallelLimit(a,1,b)};g.filterSeries=function(a,b,c){function e(k){var p;b(a[k],function(b,g){p?q(b,g):(p=1,b?c(b,d):(g&&(d[f]=a[k],f+=1),k+=1,k<h?e(k):c(b,d)))})}c=c||l;var h=a.length,d=[],f=0;e(0)};g.mapSeries=function(a,b,c){function e(f){var k;b(a[f],function(a,b){k?q(a,b):(k=1,a?c(a,d):(d[f]=b,f+=1,f<h?e(f):c(a,d)))})}c=c||l;var h=a.length,d=[];e(0)};g.filter=function(a,b,
c){g.filterParallel(a,b,c)};g.filterParallel=function(a,b,c){function e(e){var h;b(a[e],function(b,g){if(h)q(b,g);else if(h=1,b?f=0:(g&&(d[e]=a[e]),f-=1),!f&&!k)if(k=1,b)c(b,d);else{for(var l=[],x=d.length,n=0,t=0;t<x;t+=1)d[t]&&(l[n]=d[t],n+=1);c(b,l)}})}c=c||l;for(var h=a.length,d=Array(h),f=h,k=0;h;)h-=1,e(h)};g.filter=g.filterParallel;var B=function(a,b,c,e){function h(d){var h;y(a[d],b,function(a,b){if(null===d)q(a,b);else if(a)h||(h=1,c(a,f));else if(f[d]=b,d=null,k-=1,!k&&!h)if(h=1,e)c(a,f);
else{for(var g=[],l=f.length,n=0;n<l;n+=1)void 0!==f[n]&&g.push(f[n]);c(a,g)}})}c=c||l;for(var d=a.length,f=Array(d),k=d;d;)d-=1,h(d)};g.mapParallel=function(a,b,c){function e(e){var h;b(a[e],function(a,b){h?q(a,b):(h=1,a)?k||(k=1,c(a,d)):(d[e]=b,f-=1,f||k||(k=1,c(a,d)))})}c=c||l;for(var h=a.length,d=Array(h),f=h,k=0;h;)h-=1,e(h)};g.eachLimit=function(a,b,c,e){g.mapLimit(a,b,c,e)};g.eachSeries=function(a,b,c){g.mapLimit(a,b,1,c)};g.each=function(a,b,c){g.map(a,b,c)};g.mapAll=function(a,b,c){function e(e){b(a[e],
function(a,b){null===e?q(a,b):(d[e]=a?a:b,f-=1,e=null,f||(c(a,d),c=l))})}c=c||l;for(var h=a.length,d=Array(h),f=h;h;)h-=1,e(h)};g.map=g.mapParallel;g.mapAllParallel=g.mapAll;g.filterLimit=function(a,b,c,e){function h(c){var l;b(a[c],function(b,x){if(l)q(b,x);else if(l=1,b)g||(g=1,e(b,f));else if(k-=1,x&&(f[c]=a[c]),m<d)g||(k+=1,h(m++));else if(!k&&!g){g=1;for(var n=[],t=0,u=0;u<d;u+=1)f[u]&&(n[t]=f[u],t+=1);e(b,n)}})}e=e||l;var d=a.length;(!c||c>d)&&w();for(var f=[],k=0,g=0,m=0;m<c;m+=1)k+=1,h(m)};
g.mapLimit=function(a,b,c,e){function h(c){var l;b(a[c],function(a,b){l?q(a,b):(l=1,a)?g||(g=1,e(a,f)):(k-=1,f[c]=b,m<d?g||(k+=1,h(m++)):k||g||(g=1,e(a,f)))})}e=e||l;var d=a.length;(!c||c>d)&&w();for(var f=[],k=0,g=0,m=0;m<c;m+=1)k+=1,h(m)};g.parallel=function(a,b){function c(a){return function(c,d){null===a?b!==l&&q(c,d):(c?e=0:(h[a]=d,a=null,e-=1),e||(b(c,h),b=l))}}b=b||l;for(var e=a.length,h=[],d=e;d;)d-=1,console.log("tasks idx",a[d]),a[d](c(d))};g.all=function(a,b){function c(a){return function(c,
d){null===a?b!==l&&q(c,d):(h[a]=c?c:d,a=null,e-=1,e||(b(null,h),b=l))}}b=b||l;for(var e=a.length,h=[],d=e;d;)d-=1,a[d](c(d))};g.race=function(a,b){function c(a,c){a?b(a,null):b(null,c);b=l}b=b||l;for(var e=a.length;e;)e-=1,a[e](c)};g.parallelLimit=function(a,b,c){function e(b){return function(g,k){var v=b;if(null===v)q(g,k);else if(g)c(g,h),c=l;else{h[v]=k;d+=1;b=null;var v=d,r=a[v];r?r(e(v)):f?f-=1:(c(g,h),c=l)}}}(!b||b>a.length)&&w();c=c||l;for(var h=[],d=b-1,f=d,g=0;g<b;g+=1)a[g](e(g))};g.Noapply=
function(a){var b=[].slice.call(arguments,1);return function(){var c=arguments.length,e;if(0<c){e=[].slice.call(arguments);for(var g=0;g<c;g++)b.push(e[g])}return a.apply(null,b)}};g.trace=0;g.silent=0})("object"===typeof module&&"object"===typeof exports?exports:this.sonicAsync=this.sonicAsync||{});
